---
title: "Synchrony in Psychotherapy, example with F1044 patient data"
author: "Thomas Gargot"
date: "April, 26th 2016"
output: 
  pdf_document: 
    toc: yes
---
```{r clean workspace}
rm(list = ls(all.names = TRUE))
```

```{r set the working directory}
setwd("/Users/Ofix/Documents/Fac/internat/Recherche/projets/synchro/synchroData/Git/INCANT/Reports/")
```

```{r import libraries, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
# Loading libraries
## For managing data frames easilly : rbinds function
library("plyr")
## For editing string
library("stringr")
```

```{r list generators, echo=FALSE, eval=TRUE, cache=FALSE}
## Create a csv files list with the directories
fullNameList <- list.files("../Data/CSV/MotionHistory/raw", full.names=TRUE)

## Create a csv files list without the directories
filesList <- list.files("../Data/CSV/MotionHistory/raw", full.names=FALSE)

ParticipantsList <- c("father", "mother", "patient", "therapist")

# blue will refer to father
# red will refer to mother
# green to patient
# orange to therapist

colOrderList  <- c("blue","red", "green","orange")

## Code of the video only without extention of the video and .csv
# extract index list names  from the first part of the files list string (before the point)
indexList <- c()
for (i in filesList){
  name <- (strsplit(i, "[[:punct:]]"))[[1]][1]
  indexList <- c(indexList, name)
}

## Import data function, delete empty lines with NA for the 4 participants
importdata <-function(fullNameList){
    data <- c()
    for (i in fullNameList){
#        print(i)
        dataAlone <- read.csv(i)
#        str(dataAlone)
        mydata.nas <- apply(dataAlone[,ParticipantsList], 1, function(x){all(is.na(x))})
        dataAlone <- dataAlone[!mydata.nas,]
#        str(dataAlone)
        data <- rbind(data, dataAlone)
    }
    return (data)
}
```


## Import data
```{r import data}
data <- importdata(fullNameList)
```

# Lists
## Functions list
### MeanMotionByTime
Function that takes raw motion history data and compute the mean on a given interval. Intervals don't overlap, so the frequency of the data change (from 25 frames by seconde to 25 frames/interval by second).

##### Arguments:
- subject : Subject studied (patient, mother, father or therapist)
- indexOfvideos : List of videos studied (element eg 3 or list eg 1:3 or c(1,2,4))
- interval : number of frames in the studied interval
- data : data frame where there is data

```{r MeanMotionByTime function, echo=TRUE, eval=TRUE, cache=FALSE}
## Revoir nom des variables : pas clair, faire un schéma
MeanMotionByTime <- function(subject, indexOfvideos=1:NumberOfvideos, interval, data){
  x <- c()
  for (file in indexList[indexOfvideos]){
        dataVector <- data[which(data$indexList==file), subject]
        ## with ceiling : superior limit of the round
        IntervalNumbersVideo <- ceiling(length(dataVector)/interval)
        for (i in 1:IntervalNumbersVideo){
                borneinf<- 1+(i-1)*interval
                bornesup <-i*interval
                dataVectorInterval <- dataVector[borneinf:bornesup]
                mean <- mean(dataVectorInterval, na.rm=TRUE)
                x <- c(x, mean)}}
  return (x)}
```

### Slidinginterval
Function that takes raw motion history data and compute the mean on a given interval. The interval overlap, so the frequency of the data don't change. It stays at 25 frames/s.

#### Arguments:
- subject : subject studied (patient, mother, father or therapist)
- indexOfvideos : list of videos studied (element eg. 3 or list eg 1:3 or c(1,2,4))
- interval : number of frames in the studied interval
- data : data frame where there is data

```{r SlidingInterval function, cache=FALSE}
## faire un schéma
SlidingInterval <- function(subject, indexOfvideos=1:NumberOfvideos, interval, data)
  {x <- c()
  for (file in indexList[indexOfvideos]){
      dataVector <- data[which(data$indexList==file), subject]
      NBofAnalysedFrames <- length(dataVector)-interval+1
          for (i in 1:NBofAnalysedFrames){
              borneinf<- (i)
              bornesup <-(interval-1+i)
              dataVectorInterval <- dataVector[borneinf:bornesup]
              mean <- mean(dataVectorInterval, na.rm=TRUE)
              x <- c(x, mean)}}
  return (x)}
```

### MeanSynchronyByTime (TODO)
## Constants generated from data and defining it (data list, )
```{r list generator, echo=TRUE, eval=TRUE, cache=FALSE}
labelvideolist  <-c()
for (i in indexList){
    a <- str_count(i)
    name <- substr(i, 6, a)
    labelvideolist <- c(labelvideolist, name)
}

FilesName <- data.frame(unique(data$file), filesList, indexList, labelvideolist)
NumberOfvideos <- length(indexList)
```

## Merge data frame, compute Time in minutes, compute log of motion history dataframe
```{r compute minutes and log on data frame}
data <- merge(data, FilesName, by.x="file", by.y="unique.data.file.", all=TRUE)
data$timeMin <- data$frame/(25*60)

data$fatherShifted <- data$father + min(data$father[which (data$father >0)])/2
data$logFather <- log(data$fatherShifted)

#log(x -min(x)+1)
data$motherShifted <- data$mother + min(data$mother[which (data$mother >0)])/2
data$logMother <- log(data$motherShifted)

data$patientShifted <- data$patient + min(data$patient[which (data$patient >0)])/2
data$logPatient <- log(data$patientShifted)

data$therapistShifted <- data$therapist + min(data$therapist[which (data$therapist >0)])/2
data$logTherapist <- log(data$therapistShifted)

# Name of the patient (anonymised)
data$family  <- substr (data$indexList, 1, 5)

famList <- unique(data$family)

# Add date TODO

data$file <- NULL
data$filesList <- NULL

# Reorganize the data frame
data <- data[c("family", "indexList", "labelvideolist", "frame", "timeMin", "father", "fatherShifted", "logFather", "mother", "motherShifted", "logMother", "patient", "patientShifted", "logPatient", "therapist", "therapistShifted", "logTherapist")]
```
* Time in minutes
The timeMin is calculated with a frame rate of 25/sec.

* Motion history distribution
The data is not normal at all but with very small movement very frequent and bigger movement much rare with a long tail.

To normalize the distribution to compute synchrony scores on it, we made the Napierian logarithm. It produces negative numbers. SyncPy can't compute negatives scores, they are so shifted to positives values with an arbitrary value of 20 to avoid to keep extreme negative values.

Values equal to 0 can't be loged. They generate a -Inf value. These values are set to NA. We lose the information of no movement at all. If we give a arbitrary value to this data (eg, the minimum value, they are over represented)

# Presentation of the data
```{r, cache=FALSE}
str(data)
summary(data)
View(data)
```

# Length of the videos in minutes
```{r, echo=FALSE, cache=FALSE,eval=TRUE}
for (fam in famList){
    videoLengthList <-c()
    for (i in unique(data[which(data$family==fam),]$indexList)){
      index <- which(data$indexList==i & data$family==fam)
      videolength <- max(data$timeMin[index])
      videoLengthList <-c(videoLengthList,videolength)}
    
    par(mar=c(4,4,3,1))
    barplot(videoLengthList, col="cornflowerblue", cex.axis=0.6, cex.names=0.4,
            ylab="Minutes", xlab="Video Name", las=2, names=unique(data[which(data$family==fam),]$indexList), 
            main="Length of each video (min)")
            abline(h = mean(videoLengthList), lwd=2, lty=2)
            text(12,17, "Mean")}
```

## Number of Available (True) and Not Available (False) data for each participant
```{r, echo=FALSE, fig.height=5, cache=FALSE}
for (fam in famList){

  tab <- cbind(table(is.na(data[which(data$family==fam),]$father))/(25*60),table(is.na(data[which(data$family==fam),]$mother))/(25*60),table(is.na(data[which(data$family==fam),]$patient))/(25*60), table(is.na(data[which(data$family==fam),]$therapist))/(25*60)) 
      
      par(mar=c(4,4,5,1))
      barplot(tab, cex.axis = 0.7, las=2, names=ParticipantsList, 
        main="Number of available data by participant", 
        beside=TRUE, las=1, col=terrain.colors(2),
        ylab="Available data (non NA) in minutes of videos", xlab="Participants")
      legend("top", c("T", "F"), fill=terrain.colors(2))}
```

# Global Motion history
## Mean Motion history by video by participant
```{r Mean Motion history in each video, eval=FALSE, echo=FALSE, fig.height=4, cache=FALSE}
meanMotion <- function(subject, fam){
    for (i in indexList){
              index <- which(data$indexList==i & data$family==fam)
              Motionsubject<- mean(data[index,subject], na.rm=TRUE)
              #print(Motionsubject)
#              if (is.nan(Motionsubject)==FALSE){
              meanMotionList <-c(meanMotionList, Motionsubject)}
  return (meanMotionList)}

for (fam in unique(data$family)){
      meanMotionList <-c()

      Motionfatherlist <- meanMotion("father", fam)
      MotionMotherList <- meanMotion("mother", fam)
      MotionTherapistList <- meanMotion("therapist", fam)
      MotionPatientList <- meanMotion("patient", fam)
      
      print(str(Motionfatherlist))
      print(str(MotionMotherList))
      print(str(MotionTherapistList))
      print(str(MotionPatientList))
      MotionMeanList <- data.frame(Motionfatherlist, MotionMotherList, MotionPatientList, MotionTherapistList)
      MotionMeanList.nas <- apply(MotionMeanList, 1, function(x){all(is.na(x))})
      MotionMeanList <- MotionMeanList[!MotionMeanList.nas,]
      str(MotionMeanList)
      
      par(mar=c(4,4,2,1))
      barplot(as.matrix(MotionMeanList), las=2, cex.axis = 0.6, cex.names=0.6, 
              main="Mean Motion history in each video", beside=TRUE,
              names=unique(data[which(data$family==fam),]$indexList),
              col=colOrderList, ylab="Mean motion history", xlab="Video index")
      par(mar=c(1,0.5,0.5,1))
      legend("top", inset=.05, ParticipantsList, 
             fill=colOrderList, cex=0.7)}
```

We can see that configurations of subjects are very different. Consequently, it makes the comparaisons of the videos quite complicated. It is not really relevant to compare the synchrony of two persons if the context is different (other people around them).

## Raw Motion history by video by participant
### Boxplots
```{r  Motion history box plots by frame (raw data), all videos, echo=FALSE, cache=FALSE, eval =FALSE}
par(mar=c(4,4,2,2))
boxplot(data$father, data$mother, data$therapist, data$patient, 
        col=colOrderList, 
        names=ParticipantsList, 
        main= "Box plots of the Motion history by frame (raw data), all videos", las=1, ylab="Motion history", xlab="Participant")
par(mar=c(1,0.5,0.5,1))
legend("topleft", ParticipantsList, fill=colOrderList, cex=0.7)
```

### Histograms
```{r Motion history histograms by frame (raw data), all videos}
par(mar=c(4,4,2,2))
hist(data$father, col=colOrderList[1])
hist(data$mother, col=colOrderList[2])
hist(data$patient, col=colOrderList[3])
hist(data$therapist, col=colOrderList[4])
```

```{r  Kernel density plot by frame (raw data), all videos, echo=FALSE, cache=FALSE, eval =FALSE}
dFather <- density(data$father, na.rm=TRUE)
dMother <- density(data$mother, na.rm=TRUE)
dPatient <- density(data$patient, na.rm=TRUE)
dTherapist <- density(data$therapist, na.rm=TRUE)

par(mar=c(4,4,2,2))
plot(dFather, main="Kernel density plot", col=colOrderList[1])
lines(dMother,col=colOrderList[2])
lines(dPatient,col=colOrderList[3])
lines(dTherapist,col=colOrderList[4])
par(mar=c(1,0.5,0.5,1))
legend("topright", ParticipantsList, fill=colOrderList, cex=0.7)
```

## Normalized log Motion history by video by participant
### Boxplots
```{r  Normalized log of motion history box plots by frame, all videos, echo=FALSE, cache=FALSE, eval =FALSE}
par(mar=c(4,4,3,2))
boxplot(data$logFather, data$logMother, data$logPatient, data$logTherapist,
        col=colOrderList, 
        names=ParticipantsList, 
        main= "Normalized log of motion history box plots of the Motion history by frame 
        (raw data), all videos", las=1, ylab="Motion history", xlab="Participant")
par(mar=c(1,0.5,0.5,1))
legend("topleft", ParticipantsList, fill=colOrderList, cex=0.7)
```

### Histograms
```{r}
par(mar=c(4,4,2,2))
hist(data$logFather, col=colOrderList[1])
hist(data$logMother, col=colOrderList[2])
hist(data$logPatient, col=colOrderList[3])
hist(data$logTherapist, col=colOrderList[4])
```

```{r  Kernel density plot by frame (log data), all videos, echo=FALSE, cache=FALSE, eval =FALSE}
dlogFather <- density(data$logFather, na.rm=TRUE)
dlogMother <- density(data$logMother, na.rm=TRUE)
dlogPatient <- density(data$logPatient, na.rm=TRUE)
dlogTherapist <- density(data$logTherapist, na.rm=TRUE)

par(mar=c(4,4,2,2))
plot(dlogFather, main="Kernel density plot", col=colOrderList[1])
lines(dlogMother,col=colOrderList[2])
lines(dlogPatient,col=colOrderList[3])
lines(dlogTherapist,col=colOrderList[4])
par(mar=c(1,0.5,0.5,1))
legend("topright", ParticipantsList, fill=colOrderList, cex=0.7)
```

We can see that the father and the mother motion history is very similar. However. The therapist, which is always in a small window of the video, as a very different distribution. We have less signal on it. In some videos the patient is in this window, it explains, it intermediates position.

# Raw data and mean of Motion History on sliding and non overlapping intervals on 1st video F1044C1 video
It is the first video of F1044C. The father, mother and therapist are present. The patient is absent.

## Raw data
```{r, cache=FALSE}
rawFatherF1044C1 <- data[which(data$indexList=="F1044C1"),]$father
rawMotherF1044C1 <- data[which(data$indexList=="F1044C1"),]$mother
rawTherapistF1044C1 <- data[which(data$indexList=="F1044C1"),]$therapist

logFatherF1044C1 <- data[which(data$indexList=="F1044C1"),]$logFather
logMotherF1044C1 <- data[which(data$indexList=="F1044C1"),]$logMother
logTherapistF1044C1 <- data[which(data$indexList=="F1044C1"),]$logTherapist

summary(rawFatherF1044C1)
summary(rawMotherF1044C1)
summary(rawTherapistF1044C1)

summary(logFatherF1044C1)
summary(logMotherF1044C1)
summary(logTherapistF1044C1)
```

```{r Box plots of motion history raw data on F1044C1 video}
par(mar=c(4,4,3,2))
boxplot(rawFatherF1044C1, rawMotherF1044C1, rawTherapistF1044C1,
        col=colOrderList[c(1,2,4)], 
        names=ParticipantsList[c(1,2,4)], 
        main= "Box plots of motion history raw data on F1044C1 video", las=1, ylab ="Motion history", xlab="Participants")
par(mar=c(1,0.5,0.5,1))
legend("topleft", ParticipantsList[c(1,2,4)], fill=colOrderList, cex=0.7)
```

```{r Box plots of log of motion history on F1044C1 video, cache=FALSE, eval=FALSE, echo=FALSE}
par(mar=c(4,4,3,2))
boxplot(logFatherF1044C1, logMotherF1044C1, logTherapistF1044C1,
        col=colOrderList[c(1,2,4)], 
        names=ParticipantsList[c(1,2,4)], 
        main= "Box plots of log of motion history on F1044C1 video", las=1, xlab ="Motion history", ylab="Participants")
par(mar=c(1,0.5,0.5,1))
legend("topleft", ParticipantsList[c(1,2,4)], fill=colOrderList, cex=0.7)
```

## Sliding interval
```{r, cache=FALSE, eval=TRUE}
## REMINDER:
# SlidingInterval <- function(subject, indexOfvideos=1:NumberOfvideos, interval, data) with :
# subject : subject studied (patient, mother, father or therapist)
# indexOfvideos : list of videos studied (element eg. 3 or list eg 1:3 or c(1,2,4)) 
# interval : number of frames in the studied interval
# data : data frame where there is data

slidedFatherF1044C1 <- SlidingInterval("father", 1 , 5, data)
slidedMotherF1044C1 <- SlidingInterval("mother", 1 , 5, data)
slidedPatientF1044C1 <- SlidingInterval("patient", 1 , 5, data)
slidedTherapistF1044C1 <- SlidingInterval("therapist", 1 , 5, data)

slidedLogFatherF1044C1 <- SlidingInterval("logFather", 1 , 5, data)
slidedLogMotherF1044C1 <- SlidingInterval("logMother", 1 , 5, data)
slidedLogPatientF1044C1 <- SlidingInterval("logPatient", 1 , 5, data)
slidedLogTherapistF1044C1 <- SlidingInterval("logTherapist", 1 , 5, data)

summary(slidedFatherF1044C1)
summary(slidedMotherF1044C1)
summary(slidedPatientF1044C1)
summary(slidedTherapistF1044C1)

summary(slidedLogFatherF1044C1)
summary(slidedLogMotherF1044C1)
summary(slidedLogPatientF1044C1)
summary(slidedLogTherapistF1044C1)
```

## Non overlapping interval
```{r, cache=FALSE}
fatherFiveF1044C1<- MeanMotionByTime("father", indexOfvideos=1, interval=5, data)

motherFiveF1044C1 <- MeanMotionByTime("mother", indexOfvideos=1, interval=5, data)

therapistFiveF1044C1 <- MeanMotionByTime("therapist", indexOfvideos=1, interval=5, data)

fatherLogFiveF1044C1<- MeanMotionByTime("logFather", indexOfvideos=1, interval=5, data)

motherLogFiveF1044C1 <- MeanMotionByTime("logMother", indexOfvideos=1, interval=5, data)

therapistLogFiveF1044C1 <- MeanMotionByTime("logTherapist", indexOfvideos=1, interval=5, data)

summary(fatherFiveF1044C1)
summary(motherFiveF1044C1)
summary(therapistFiveF1044C1)

summary(fatherLogFiveF1044C1)
summary(motherLogFiveF1044C1)
summary(therapistLogFiveF1044C1)
```

# Focus on the motion history of the first 10 seconds of the first video 
## Sliding interval function on a raw data, 5 frames interval
```{r, cache=FALSE, echo=TRUE}
par(mar=c(4,4,4,2))
plot(1:250, data$father[3:252], main="Mean motion history, (Sliding 5 frames interval raw data) 
    on 1st video, first 10 seconds ", xlab="Frame index (25/s)",
     ylab="Motion history",
     col="blue", type="l", lty=2, lwd=0.5)
lines(slidedFatherF1044C1[1:250],  col="blue", lty=1)
lines(data$mother[3:252],  col="red", lty=2, lwd=0.5)
lines(slidedMotherF1044C1[1:250],  col="red", lty=1)
lines(data$therapist[3:252],  col="orange", lty=2, lwd=0.5)
lines(slidedTherapistF1044C1[1:250],  col="orange", lty=1)
legend("topleft", c("Raw data", "Mean on sliding Interval") , lty=c(2, 1), cex=0.7)
legend("topright", ParticipantsList[c(1,2,4)], fill=colOrderList[c(1,2,4)], cex=0.7)
```

## Sliding interval function on log data, 5 frames interval
```{r, cache=FALSE, echo=TRUE}
par(mar=c(4,4,4,2))
plot(1:250, data$logFather[3:252], main="Mean motion history, (Sliding 5 frames interval log data) 
    on 1st video, first 10 seconds", xlab="Frame index (25/s)",
     ylab="Motion history",
     col="blue", type="l", lty=2, lwd=0.5)
lines(slidedLogFatherF1044C1[1:250],  col="blue", lty=1)
lines(data$logMother[3:252],  col="red", lty=2, lwd=0.5)
lines(slidedLogMotherF1044C1[1:250],  col="red", lty=1)
lines(data$logTherapist[3:252],  col="orange", lty=2, lwd=0.5)
lines(slidedLogTherapistF1044C1[1:250],  col="orange", lty=1)
legend("topleft", c("Raw data", "Mean on sliding Interval") , lty=c(2, 1), cex=0.7)
legend("topright", ParticipantsList[c(1,2,4)], fill=colOrderList[c(1,2,4)], cex=0.7)
```

### Non overlapping interval function on a 5 frames interval
```{r, cache=FALSE}
plot (1:50, fatherFiveF1044C1[1:50], type="l", col="blue", 
main="Mean Motion history (non overlapping 5 frames
      intervals) for father on F1044C video, first 10 seconds", 
ylab="Motion history", xlab="Frame index (each 5 frames)" )
lines(motherFiveF1044C1[1:50], col="red", lty=1)
lines(therapistFiveF1044C1[1:50], col="green", lty=1)
legend("topleft", "Mean on non overlapping Interval" , lty=1, cex=0.7)
legend("topright", ParticipantsList[c(1,2,4)], fill=colOrderList, cex=0.7)
```

## Motion history of the father during 10-20 seconds of the first video(C) 
### Non overlapping interval function on a 5 frames interval
```{r, cache=FALSE}
par(mar=c(4,4,4,2))
plot(1:250, data$father[253:502], main="Mean motion history (Sliding 5 frames
     interval) for father on F1044C video, 10-20 seconds", xlab="Frame index (25/s)", 
     ylab="Motion history", col="blue", type="l", lty=2, lwd=0.5)
lines(slidedFatherF1044C1[251:500],  col="blue", lty=1)
lines(data$mother[253:502],  col="red", lty=2, lwd=0.5)
lines(slidedMotherF1044C1[251:500],  col="red", lty=1)
lines(data$therapist[253:502],  col="orange", lty=2, lwd=0.5)
lines(slidedTherapistF1044C1[251:500],  col="orange", lty=1)
legend("topleft", c("Raw data", "Mean on sliding Interval") , lty=c(2, 1), cex=0.7)
legend("topright", ParticipantsList[c(1,2,4)], fill=colOrderList[c(1,2,4)], cex=0.7)
```

### Non overlapping interval function on a 5 frames interval
```{r, cache=FALSE}
plot (1:50, fatherFiveF1044C1[51:100], type="l", col="blue", 
main="Mean motion history (non overlapping 5 frames intervals) for 
father on F1044C video, between 10-20 seconds", 
ylab="Motion history", xlab="Frame index (each 5 frames)", ylim=c(0, 0.009))
lines(motherFiveF1044C1[51:100], col="red", lty=1)
lines(therapistFiveF1044C1[51:100], col="green", lty=1)
legend("top", "Mean on non overlapping Interval" , lty=1, cex=0.7)
legend("topright", ParticipantsList[c(1,2,4)], fill=colOrderList, cex=0.7)
```

# Mean motion history by minute plots
```{r, fig.height=4, cache=FALSE}
for (i in 1:NumberOfvideos){
  fatherMinute<- MeanMotionByTime("father", indexOfvideos=i, interval=1500, data)

  MotherMinute<- MeanMotionByTime("mother", indexOfvideos=i, interval=1500, data)

  TherapistMinute<- MeanMotionByTime("therapist", indexOfvideos=i, interval=1500, data)

  PatientMinute<- MeanMotionByTime("patient", indexOfvideos=i, interval=1500, data)

  par(mar=c(4,4,4,2))
      plot (1:length(fatherMinute), fatherMinute, type="l", col="blue", 
      main=paste("Mean motion history (non overlaping minute intervals) 
      on F1044", labelvideolist[i], " video" , sep=""), 
      ylab="Motion history", xlab="Time by Minute", ylim=c(0, 12E-03), 
      xaxp=c(0, length(fatherMinute), length(fatherMinute)))
      lines(MotherMinute, col="red")
      lines(TherapistMinute, col="orange")
      lines(PatientMinute, col="green")
      legend("top", inset=.05, ParticipantsList, 
             fill=colOrderList, cex=0.7)}
```

# Mean log motion history by minute plots
```{r, fig.height=4, cache=FALSE}
for (i in 1:NumberOfvideos){
  fatherMinute<- MeanMotionByTime("logFather", indexOfvideos=i, interval=1500, data)

  MotherMinute<- MeanMotionByTime("logMother", indexOfvideos=i, interval=1500, data)

  TherapistMinute<- MeanMotionByTime("logTherapist", indexOfvideos=i, interval=1500, data)

  PatientMinute<- MeanMotionByTime("logPatient", indexOfvideos=i, interval=1500, data)

  par(mar=c(4,4,4,2))
      plot (1:length(fatherMinute), fatherMinute, type="l", col="blue", 
      main=paste("Mean motion history (non overlaping minute intervals) 
      on F1044", labelvideolist[i], " video" , sep=""), 
      ylab="Motion history", xlab="Time by Minute", ylim=c(-11, -3), 
      xaxp=c(0, length(fatherMinute), length(fatherMinute)))
      lines(MotherMinute, col="red")
      lines(TherapistMinute, col="orange")
      lines(PatientMinute, col="green")
      legend("top", inset=.05, ParticipantsList, 
             fill=colOrderList, cex=0.7)}
```

# Motion history by minute for the F1044C video
```{r, eval=TRUE, cache=FALSE}
slidedFather <- SlidingInterval("father", 1 , 50, data)
slidedMother <- SlidingInterval("mother", 1 , 50, data)
slidedTherapist <- SlidingInterval("therapist", 1 , 50, data)
slidedPatient <- SlidingInterval("patient", 1 , 50, data)
```

```{r}
framesByMinute <- 60*25
F1044C_Minutes <- ceiling(length(slidedFather)/framesByMinute)
for (i in 1:(F1044C_Minutes-1)){
      par(mar=c(4,4,4,2))
      borneInf <- i+framesByMinute*(i-1)
      borneSup <- i+i*framesByMinute
      slidedFatherMinute<-slidedFather[borneInf:borneSup]
      slidedMotherMinute<-slidedMother[borneInf:borneSup]
      slidedTherapistMinute<-slidedTherapist[borneInf:borneSup]
      slidedPatientMinute<-slidedPatient[borneInf:borneSup]
      slidedVideoDF <- data.frame(slidedFatherMinute, slidedMotherMinute, slidedTherapistMinute, slidedPatientMinute, "frames"= 1:length(slidedFatherMinute),  "minute"= 1:length(slidedFatherMinute)/25)
      str (slidedVideoDF)
      plot (slidedVideoDF$minute, slidedVideoDF$slidedMotherMinute, type="l", col="red", 
      main=paste("Motion history with Sliding interval function during 
                 minute ", i, " in F1044C video", sep=""), 
      ylab="Motion history", xlab="Number of frame", ylim=c(0, 12E-03))
#     xaxp=c(0, length(slidedFatherMinute), length(slidedFatherMinute)))
      lines(slidedVideoDF$minute, slidedVideoDF$slidedFatherMinute, col="blue")
      lines(slidedVideoDF$minute, slidedVideoDF$slidedTherapistMinute, col="orange")
      lines(slidedVideoDF$minute, slidedVideoDF$slidedPatientMinute, col="green")
      legend("top", inset=.05, ParticipantsList, 
             fill=colOrderList, cex=0.7)}
```

# Export no log filtered data in text files
```{r, eval=FALSE, cache=FALSE}
## REMINDER:
#SlidingInterval <- function(subject, indexOfvideos=1:NumberOfvideos, interval, data) with :
# subject : subject studied (patient, mother, father or therapist)
# indexOfvideos : list of videos studied (element eg. 3 or list eg 1:3 or c(1,2,4)) 
# interval : number of frames in the studied interval
# data : data frame where there is data

#index de la vid?eo de 1ere a la length de indexvideo

videoIndex <- 1
# videoName est le nom de la video actuelle
for (videoName in indexList){
# Compute slinding interval for each participant
      print(paste("Computing slidedFather", videoName))
      slidedFather <- SlidingInterval("father", videoIndex, 5, data)
      
      print(paste("Computing slidedMother", videoName))
      slidedMother <- SlidingInterval("mother", videoIndex, 5, data)
      
      print(paste("Computing slidedPatient", videoName))
      slidedPatient <- SlidingInterval("patient", videoIndex, 5, data)
      
      print(paste("Computing slidedTherapist", videoName))
      slidedTherapist <- SlidingInterval("therapist", videoIndex, 5, data)
      
# create a data frame to store temporarily this data with NA
      slidedVideo <- data.frame(
        slidedFather, slidedMother, slidedPatient, slidedTherapist, 
        "video"=rep(indexList[videoIndex], length(slidedFather)), 
        frame_index = 1:length(slidedFather))
      
      str(slidedVideo)
      summary(slidedVideo)
#      dfSliding <- data.frame()
#      for (participant in 1:4){
# If the colum is not empty, takes its length and begin a data frame with it
#          if (dataFrame == FALSE & (length(slidedVideo[participant][!is.na(slidedVideo[participant])]) > 0)){
#                dfSliding <- data.frame(
#                  "video"=rep(indexList[videoIndex], length(slidedVideo[participant])), 
#                  frame_index = (1:dim(slidedVideo[1])[1]),
#                  slidedVideo[participant])
#                  dataFrame <- TRUE}
#          else if (dataFrame == FALSE){} 
#          else{
#            dfSliding <- cbind(dfSliding, slidedVideo[participant])}
#      }
      write.csv(slidedVideo, paste("/Users/Ofix/Documents/Fac/internat/Recherche/projets/synchro/synchroData/Git/INCANT/Data/CSV/MotionHistory/filtered/noLog/",videoName, ".slideddata.csv", sep=""))
      videoIndex <-(videoIndex+1)
}
```

# Export log filtered data in text files
```{r, eval=FALSE, cache=FALSE}
videoIndex <- 1
# videoName est le nom de la video actuelle
for (videoName in indexList){
# Compute slinding interval for each participant
      print(paste("Computing slidedFather", videoName))
      slidedFather <- SlidingInterval("logFather", videoIndex, 5, data)
      
      print(paste("Computing slidedMother", videoName))
      slidedMother <- SlidingInterval("logMother", videoIndex, 5, data)
      
      print(paste("Computing slidedPatient", videoName))
      slidedPatient <- SlidingInterval("logPatient", videoIndex, 5, data)
      
      print(paste("Computing slidedTherapist", videoName))
      slidedTherapist <- SlidingInterval("logTherapist", videoIndex, 5, data)
      
# create a data frame to store temporarily this data with NA
      
      slidedVideo <- data.frame(
        slidedFather, slidedMother, slidedPatient, slidedTherapist, 
        "video"=rep(indexList[videoIndex], length(slidedFather)), 
        frame_index = 1:length(slidedFather))
      
            write.csv(slidedVideo, paste("/Users/Ofix/Documents/Fac/internat/Recherche/projets/synchro/synchroData/Git/INCANT/Data/CSV/MotionHistory/filtered/log/",videoName, ".log.slideddata.csv", sep=""))
      videoIndex <-(videoIndex+1)
      }
```

# SyncPy utilisation for creating synchrony dataframe
### After extracting filtered motion motion history with mean on sliding interval (overlapping interval) of 5 frames
### And after puting this data on a CSV file [slideddata.csv]( /Users/Ofix/Documents/Fac/internat/Recherche/projets/synchro/synchroData/slideddata.csv)
### We import this data on python Script with panda module [Call_S_Estimator.py](/SyncPy/examples/Call_S_Estimator.py)
### This script will compute the synchrony between each dyad of the interaction and of the whole group
### It will return a csv file for each video [SSIXXXX.csv](/SyncPy/examples/SynchronyCSV/SSIXXXX.csv) with XXXX the name of the video (F1044C, F1044D1, etc) that we can import with R with
### this following function

```{r, eval= TRUE, echo=FALSE, cache=FALSE}
write.csv(indexList, paste("/Users/Ofix/Documents/Fac/internat/Recherche/projets/synchro/synchroData/Git/INCANT/Data/CSV/studyInfoData/","indexList.slideddata.csv", sep=""))

#videoDate <- read.csv2("/Users/Ofix/Documents/Fac/internat/Recherche/projets/synchro/synchroData/Git/INCANT/Data/CSV/studyInfoData/videoDate.csv")
#videoDate[which(videoDate$video==i),1]

print("SSI Files Directory")
print("SSI Files List")
SSIlogFilesList <- list.files("../Data/CSV/Synchrony/log", full.names=TRUE)
SSIFilesList <- list.files("../Data/CSV/Synchrony/noLog", full.names=TRUE)
SSIlogFilesList
SSIFilesList

SSIlogdataFrame <- data.frame()
SSI <- data.frame()
for (file in SSIlogFilesList){
    SSIlog <- read.csv(file)
    SSIlogdataFrame<- rbind.fill(SSIlogdataFrame, SSIlog)}

SSIdataFrame <- data.frame()
SSI <- data.frame()
for (file in SSIFilesList){
    SSI <- read.csv(file)
    SSIdataFrame<- rbind.fill(SSIdataFrame, SSI)}
  
#  for (a in 1:length(videoDate$video)){
#        if (as.character(SSI[1,]$video) == as.character(videoDate[a,]$video)){
#          date <- as.character(videoDate[a,]$date)
#          dates <- as.Date(date, "%m/%d/%y")
#          SSI$date <- dates
#    }}


# change the order of the data frame to have date and video name beside
#SSIdataFrame <- SSIdataFrame[c("X","Interval", "Time_min", "video", "date", "SSI_fa_mo", "SSI_fa_mo_th", "SSI_fa_th", "SSI_mo_th", "SSI_fa_pa", "SSI_fa_mo_pa", "SSI_mo_pa", "SSI_pa_th", "SSI_mo_pa_th")]
```

## Description of SSI data frame
```{r, eval=TRUE, cache=FALSE}
str(SSIdataFrame)
```

# Synchrony scores for each dyad, triad and for the whole group
In legend, mean for all the video.
```{r, eval=TRUE,  fig.width=8, cache=FALSE}
for (i in unique(SSIdataFrame$video))
      {par(mar=c(4,4,4,3), mfrow=c(1,1))
      plot(SSIdataFrame[which(SSIdataFrame$video==i),]$Time_min,
           SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_fa_mo, 
           type="l", ylim=c(0, 0.3), col=rainbow(4)[1], 
           main=paste("Synchrony scores for each dyad and for \n the whole group in", i, "video"), 
           xlab = "Time (minute)", ylab="Synchrony score", lwd=2,
xaxp=c(0,length(SSIdataFrame$Time_min), length(SSIdataFrame$Time_min)))
      abline(h=mean(SSIdataFrame$SSI_fa_mo, na.rm=TRUE), col=rainbow(11)[1], lwd=2, lty=2)
      
      lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_fa_mo_pa, col=rainbow(11)[2], lwd=2)
      abline(h= mean(SSIdataFrame$SSI_fa_mo_pa, na.rm=TRUE), col=rainbow(11)[2], lwd=2, lty=2)
      
#      lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_fa_mo_pa_th, col=rainbow(11)[3], lwd=2)
#      abline(h= mean(SSIdataFrame$SSI_fa_mo_pa_th, na.rm=TRUE), col=rainbow(11)[3], lwd=2, lty=2)
      
      lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_fa_mo_th, col=rainbow(11)[4], lwd=2)
      abline(h= mean(SSIdataFrame$SSI_fa_mo_th, na.rm=TRUE), col=rainbow(11)[4], lwd=2, lty=2)

      lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_fa_pa, col=rainbow(11)[5], lwd=2)
      abline(h= mean(SSIdataFrame$SSI_fa_pa, na.rm=TRUE), col=rainbow(11)[5], lwd=2, lty=2)
      
#      lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_fa_pa_th, col=rainbow(11)[6], lwd=2)
#      abline(h= mean(SSIdataFrame$SSI_fa_pa_th, na.rm=TRUE), col=rainbow(11)[6], lwd=2, lty=2)
      
lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_fa_th, col=rainbow(11)[7], lwd=2)
abline(h= mean(SSIdataFrame$SSI_fa_th, na.rm=TRUE), col=rainbow(11)[7], lwd=2, lty=2)
      
lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_mo_pa, col=rainbow(11)[8], lwd=2)
abline(h= mean(SSIdataFrame$SSI_mo_pa, na.rm=TRUE), col=rainbow(11)[8], lwd=2, lty=2)
      
lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_mo_pa_th, col=rainbow(11)[9], lwd=2)
abline(h= mean(SSIdataFrame$SSI_mo_pa_th, na.rm=TRUE), col=rainbow(11)[9], lwd=2, lty=2)      
lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_mo_th, col=rainbow(11)[10], lwd=2)
abline(h= mean(SSIdataFrame$SSI_mo_th, na.rm=TRUE), col=rainbow(11)[10], lwd=2, lty=2)
    
      lines(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_pa_th, col=rainbow(11)[11], lwd=2)
      abline(h= mean(SSIdataFrame$SSI_pa_th, na.rm=TRUE), col=rainbow(11)[11], lwd=2, lty=2)
      
legend("topleft", inset=.05, c("fa_mo", "fa_mo_pa", "fa_mo_pa_th", 
"fa_mo_th", "fa_pa", "fa_pa_th", "fa_th",
"mo_pa", "mo_pa_th", "mo_th", "pa_th"), 
col=rainbow(11), cex=0.6, lwd=2)
      
legend("topright", inset=.05, c(paste ("Mean fa_mo :",
                                       round(mean(SSIdataFrame$SSI_fa_mo, na.rm=TRUE),3)),
      paste ("Mean fa_mo_pa :", round(mean(SSIdataFrame$SSI_fa_mo_pa,na.rm=TRUE),3)),
#      paste ("Mean fa_mo_pa_th :", #round(mean(SSIdataFrame$SSI_fa_mo_pa_th),3)),
      paste ("Mean fa_mo_th :", round(mean(SSIdataFrame$SSI_fa_mo_th,na.rm=TRUE),3)),
      paste ("Mean fa_pa :", round(mean(SSIdataFrame$SSI_fa_pa, na.rm=TRUE),3)),
#      paste ("Mean fa_pa_th :", round(mean(SSIdataFrame$SSI_fa_pa_th,na.rm=TRUE),3)),
      paste ("Mean fa_th :", round(mean(SSIdataFrame$SSI_fa_th,na.rm=TRUE),3)),
      paste ("Mean mo_pa :", round(mean(SSIdataFrame$SSI_mo_pa,na.rm=TRUE),3)),
      paste ("Mean mo_pa_th :", round(mean(SSIdataFrame$SSI_mo_pa_th,na.rm=TRUE),3)),
      paste ("Mean mo_th :", round(mean(SSIdataFrame$SSI_mo_th,na.rm=TRUE),3)),
      paste ("Mean pa_th :", round(mean(SSIdataFrame$SSI_pa_th,na.rm=TRUE),3))), 
col=rainbow(11), cex=0.5, lty=2, lwd=1)}
```

# Synchrony scores(log data) for each dyad, triad and for the whole group
In legend, mean for all the video.
```{r, eval=TRUE,  fig.width=8, cache=FALSE}
for (i in unique(SSIlogdataFrame$video))
      {par(mar=c(4,4,4,3), mfrow=c(1,1))
      plot(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$Time_min,
           SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_fa_mo, 
           type="l", ylim=c(0, 0.3), col=rainbow(4)[1], 
           main=paste("Synchrony scores for each dyad and for \n the whole group in", i, "video"), 
           xlab = "Time (minute)", ylab="Synchrony score", lwd=2,
xaxp=c(0,length(SSIlogdataFrame$Time_min), length(SSIlogdataFrame$Time_min)))
      abline(h=mean(SSIlogdataFrame$SSI_fa_mo, na.rm=TRUE), col=rainbow(11)[1], lwd=2, lty=2)
      
      lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_fa_mo_pa, col=rainbow(11)[2], lwd=2)
      abline(h= mean(SSIlogdataFrame$SSI_fa_mo_pa, na.rm=TRUE), col=rainbow(11)[2], lwd=2, lty=2)
      
#      lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_fa_mo_pa_th, col=rainbow(11)[3], lwd=2)
#      abline(h= mean(SSIlogdataFrame$SSI_fa_mo_pa_th, na.rm=TRUE), col=rainbow(11)[3], lwd=2, lty=2)
      
      lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_fa_mo_th, col=rainbow(11)[4], lwd=2)
      abline(h= mean(SSIlogdataFrame$SSI_fa_mo_th, na.rm=TRUE), col=rainbow(11)[4], lwd=2, lty=2)

      lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_fa_pa, col=rainbow(11)[5], lwd=2)
      abline(h= mean(SSIlogdataFrame$SSI_fa_pa, na.rm=TRUE), col=rainbow(11)[5], lwd=2, lty=2)
      
#      lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_fa_pa_th, col=rainbow(11)[6], lwd=2)
#      abline(h= mean(SSIlogdataFrame$SSI_fa_pa_th, na.rm=TRUE), col=rainbow(11)[6], lwd=2, lty=2)
      
lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_fa_th, col=rainbow(11)[7], lwd=2)
abline(h= mean(SSIlogdataFrame$SSI_fa_th, na.rm=TRUE), col=rainbow(11)[7], lwd=2, lty=2)
      
lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_mo_pa, col=rainbow(11)[8], lwd=2)
abline(h= mean(SSIlogdataFrame$SSI_mo_pa, na.rm=TRUE), col=rainbow(11)[8], lwd=2, lty=2)
      
lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_mo_pa_th, col=rainbow(11)[9], lwd=2)
abline(h= mean(SSIlogdataFrame$SSI_mo_pa_th, na.rm=TRUE), col=rainbow(11)[9], lwd=2, lty=2)      
lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_mo_th, col=rainbow(11)[10], lwd=2)
abline(h= mean(SSIlogdataFrame$SSI_mo_th, na.rm=TRUE), col=rainbow(11)[10], lwd=2, lty=2)
    
      lines(SSIlogdataFrame[which(SSIlogdataFrame$video==i),]$SSI_pa_th, col=rainbow(11)[11], lwd=2)
      abline(h= mean(SSIlogdataFrame$SSI_pa_th, na.rm=TRUE), col=rainbow(11)[11], lwd=2, lty=2)
      
legend("topleft", inset=.05, c("fa_mo", "fa_mo_pa", "fa_mo_pa_th", 
"fa_mo_th", "fa_pa", "fa_pa_th", "fa_th",
"mo_pa", "mo_pa_th", "mo_th", "pa_th"), 
col=rainbow(11), cex=0.6, lwd=2)
      
legend("topright", inset=.05, c(paste ("Mean fa_mo :",
                                       round(mean(SSIlogdataFrame$SSI_fa_mo, na.rm=TRUE),3)),
      paste ("Mean fa_mo_pa :", round(mean(SSIlogdataFrame$SSI_fa_mo_pa,na.rm=TRUE),3)),
#      paste ("Mean fa_mo_pa_th :", #round(mean(SSIlogdataFrame$SSI_fa_mo_pa_th),3)),
      paste ("Mean fa_mo_th :", round(mean(SSIlogdataFrame$SSI_fa_mo_th,na.rm=TRUE),3)),
      paste ("Mean fa_pa :", round(mean(SSIlogdataFrame$SSI_fa_pa, na.rm=TRUE),3)),
#      paste ("Mean fa_pa_th :", round(mean(SSIlogdataFrame$SSI_fa_pa_th,na.rm=TRUE),3)),
      paste ("Mean fa_th :", round(mean(SSIlogdataFrame$SSI_fa_th,na.rm=TRUE),3)),
      paste ("Mean mo_pa :", round(mean(SSIlogdataFrame$SSI_mo_pa,na.rm=TRUE),3)),
      paste ("Mean mo_pa_th :", round(mean(SSIlogdataFrame$SSI_mo_pa_th,na.rm=TRUE),3)),
      paste ("Mean mo_th :", round(mean(SSIlogdataFrame$SSI_mo_th,na.rm=TRUE),3)),
      paste ("Mean pa_th :", round(mean(SSIlogdataFrame$SSI_pa_th,na.rm=TRUE),3))), 
col=rainbow(11), cex=0.5, lty=2, lwd=1)}
```

## Evolution of synchrony through time, raw each second
### Nolog data
```{r, eval=TRUE, fig.width=8, cache=FALSE}
par(mar=c(4,4,4,4))
    col <- 1
for (i in 6:length(SSIdataFrame)){
    plot(1:length(SSIdataFrame[,i]), SSIdataFrame[,i], type="l",
    col=rainbow(11)[col], main = names(SSIdataFrame)[i])
    col <- col+1}
```

### log data
```{r, eval=TRUE, fig.width=8, cache=FALSE}
par(mar=c(4,4,4,4))
    col <- 1
for (i in 6:length(SSIlogdataFrame)){
    plot(1:length(SSIlogdataFrame[,i]), SSIlogdataFrame[,i], type="l",
    col=rainbow(11)[col], main = names(SSIlogdataFrame)[i])
    col <- col+1}
```

## Evolution of synchrony through time, mean by minute
### No log data
```{r, eval=TRUE, fig.width=8, cache=FALSE}
par(mar=c(4,4,4,4))
    col = 1
for (indexSSI in 6:length(SSIdataFrame)){
    IntervalNumbersVideo <- ceiling(length(SSIdataFrame[,indexSSI])/6)
    SSIColumn <- SSIdataFrame[,indexSSI]
    SSIdataFrameMinute <- c()
    for (i in 1:IntervalNumbersVideo){
          borneInf <- 1+(i-1)*6
          borneSup <- i * 6
          SSIVectorInterval <- SSIColumn[borneInf:borneSup]
          mean <- mean(SSIVectorInterval, na.rm=TRUE)
          SSIdataFrameMinute <- c(SSIdataFrameMinute, mean)}
    plot(1:length(SSIdataFrameMinute), SSIdataFrameMinute, type="l", col=rainbow(11)[col], main = names(SSIdataFrame)[indexSSI])
    col <- col+1}
```

### Log data
```{r, eval=TRUE, fig.width=8, cache=FALSE}
par(mar=c(4,4,4,4))
    col = 1
for (indexSSI in 6:length(SSIlogdataFrame)){
    IntervalNumbersVideo <- ceiling(length(SSIlogdataFrame[,indexSSI])/6)
    SSIlogColumn <- SSIlogdataFrame[,indexSSI]
    SSIlogdataFrameMinute <- c()
    for (i in 1:IntervalNumbersVideo){
          borneInf <- 1+(i-1)*6
          borneSup <- i * 6
          SSIlogVectorInterval <- SSIlogColumn[borneInf:borneSup]
          mean <- mean(SSIlogVectorInterval, na.rm=TRUE)
          SSIlogdataFrameMinute <- c(SSIlogdataFrameMinute, mean)}
    plot(1:length(SSIlogdataFrameMinute), SSIlogdataFrameMinute, type="l", col=rainbow(11)[col], main = names(SSIlogdataFrame)[indexSSI])
    col <- col+1}
```

## Evolution of synchrony through time, mean by 10 minutes
```{r, eval=FALSE, fig.width=8, cache=FALSE}
par(mar=c(4,4,4,4))
    col = 1
for (indexSSI in 6:length(SSIdataFrame)){
    IntervalNumbersVideo <- ceiling(length(SSIdataFrame[,indexSSI])/60)
    SSIColumn <- SSIdataFrame[,indexSSI]
    SSIdataFrameTenMinute <- c()
    for (i in 1:IntervalNumbersVideo){
          borneInf <- 1+(i-1)*60
          borneSup <- i * 60
          SSIVectorInterval <- SSIColumn[borneInf:borneSup]
          mean <- mean(SSIVectorInterval, na.rm=TRUE)
          SSIdataFrameTenMinute <- c(SSIdataFrameTenMinute, mean)}
    plot(1:length(SSIdataFrameTenMinute), SSIdataFrameTenMinute, type="l", col=rainbow(11)[col], main = names(SSIdataFrame)[indexSSI])
    col <- col+1}
```

## Models of synchrony
```{r, eval=FALSE, cache=TRUE}
SSI_fa_th_lme <- lmer(SSI_fa_th ~ Time_min + (1|video), data=SSIdataFrame)
summary(SSI_fa_th_lme)
#plot(SSI_fa_th_lme)
res <- residuals(SSI_fa_th_lme)
hist(SSIdataFrame$SSI_fa_th)
qqnorm(res)
SSI_fa_th_List <- c()
for (i in indexList){
  SSI_fa_th_List <- c(SSI_fa_th_List, mean(SSIdataFrame[which(SSIdataFrame$video==i),]$SSI_fa_th, na.rm=TRUE))
}
print(SSI_fa_th_List)
#plot(SSI_fa_th_List, type="b")
```

```{r, eval=FALSE, cache=TRUE}
# log of the data
log_SSI_fa_th <- hist(log(SSIdataFrame$SSI_fa_th))
SSI_fa_th_log_lme <- lmer(log(SSI_fa_th) ~ Time_min + (1|video), data=SSIdataFrame)
res_log <- residuals(SSI_fa_th_log_lme)
qqnorm(res_log)
summary(SSI_fa_th_log_lme)
```

```{r, eval=FALSE, cache=TRUE}
# root square of the data
sq_SSI_fa_th <- hist(sqrt(SSIdataFrame$SSI_fa_th))
SSI_fa_th_sq_lme <- lmer(sqrt(SSI_fa_th) ~ Time_min + (1|video), data=SSIdataFrame)
res_sq <- residuals(SSI_fa_th_sq_lme)
qqnorm(res_sq)
summary(SSI_fa_th_sq_lme)
```