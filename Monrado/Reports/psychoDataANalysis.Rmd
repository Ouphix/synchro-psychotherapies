---
title: "psychometricdata"
author: "Thomas Gargot"
date: "22 septembre 2016"
output: html_document
---
# Clean environment
```{r Clean Environment}
rm(list = ls(all.names = TRUE))
```

# Session info
```{r}
sessionInfo()
```

# Preparation of the session
```{r import libraries, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
# To use this script, you must install packages (install.packages()) to install these packages if you don't have them.

# Loading libraries
## For managing data frames easilly : rbinds function
library("plyr")
## For editing string
library("stringr")
## For computing AUC of syncrony plots
library("AUC")
```

## Fixed variables
```{r Variables to fix}
FileExtension <- ".MTS.avi_res.csv"

# working directory
# where this report is
setwd("./Git/Monrado/Reports/")

# blue will refer to father
# red will refer to mother
# green to child
colOrderList <- c("blue","red", "green")

ParticipantsList <- c("father", "mother", "child")
```

```{r creating list, eval=TRUE, cache=FALSE, results='hide'}
## Create a csv files list with the directories names
FullNameList <- list.files("../Data/CSV/raw", full.names=TRUE)
FullNameList

## Create a csv files list without the directories names
filesList <- list.files("../Data/CSV/raw", full.names=FALSE)
filesList
```
```{r cutFrames to translate for ME}
# Import data
cutFrames <- read.csv2("../Data/CSV/Cutframes.csv")
str(cutFrames)

# Change the vector in character and cut the string in two parts minutes and second for the 4 time labels ("CutBefore"  "CutMiddle1" "CutMiddle2" "CutFinal") 
cutFrames$CutBefore <- as.character(cutFrames$CutBefore)
cutFramesCB <- strsplit(cutFrames$CutBefore, split=":")

# Compute the time in minutes from time in minutes and seconds for each video for Cut Before
Cut <- c()
for (i in 1:nrow(cutFrames)){ 
  CutBeforeAlone <- (as.numeric(cutFramesCB[i][[1]][1]) + as.numeric(cutFramesCB[i][[1]][2])/60)
  Cut <- c(Cut, CutBeforeAlone)
  }
cutFrames$CutBeforeMin <- Cut

# Compute the time in minutes from time in minutes and seconds for each video for Cut CutMiddle1
Cut <- c()
cutFrames$CutMiddle1 <- as.character(cutFrames$CutMiddle1)
cutMiddleSplit <- strsplit(cutFrames$CutMiddle1, split=":")
for (i in 1:nrow(cutFrames)){ 
  CutAlone <- (as.numeric(cutMiddleSplit[i][[1]][1]) + as.numeric(cutMiddleSplit[i][[1]][2])/60)
  Cut <- c(Cut, CutAlone)
  }
cutFrames$CutMiddle1Min <- Cut

# Compute the time in minutes from time in minutes and seconds for each video for Cut CutMiddle2
Cut <- c()
cutFrames$CutMiddle2 <- as.character(cutFrames$CutMiddle2)
cutMiddleSplit <- strsplit(cutFrames$CutMiddle2, split=":")
for (i in 1:nrow(cutFrames)){ 
  CutAlone <- (as.numeric(cutMiddleSplit[i][[1]][1]) + as.numeric(cutMiddleSplit[i][[1]][2])/60)
  Cut <- c(Cut, CutAlone)
  }
cutFrames$CutMiddle2Min <- Cut

# Compute the time in minutes from time in minutes and seconds for each video for Cut CutFinal
Cut <- c()
cutFrames$CutFinal <- as.character(cutFrames$CutFinal)
cutSplit <- strsplit(cutFrames$CutFinal, split=":")
for (i in 1:nrow(cutFrames)){ 
  CutAlone <- (as.numeric(cutSplit[i][[1]][1]) + as.numeric(cutSplit[i][[1]][2])/60)
  Cut <- c(Cut, CutAlone)
  }
cutFrames$CutFinalMin <- Cut
Cut <- c()
```

### Data dictionnary of cutFrames dataframe
* **family** : code of the family
* **CutBefore** : when the experimenter leave the room and the interaction begin character string in the form min:sec
* **CutMiddle1** : when the experimenter come back to explain that the participants are asked to have a conflictual discussion, character string in the form min:sec
* **CutMiddle2** : when the experimenter leave and the conflictual discussion begin
Between is the conflictual discussion, character string in the form min:sec
* **CutFinal** : when the experimenter come back to shut down the camera, character string in the form min:sec
* **ChildSex** : Factor variable : Male of Female
* **ParentSex** : Factor variable : Male of Female
* **CutBeforeMin** : when the experimenter leave the room and the interaction begin numeric variable in minutes
* **CutMiddle1Min** : when the experimenter come back to explain that the participants are asked to have a conflictual discussion, numeric variable in minutes
* **CutMiddle2Min** : when the experimenter leave and the conflictual discussion begin
Between is the conflictual discussion, numeric variable in minutes
* **CutFinalMin** : when the experimenter come back to shut down the camera, numeric variable in minutes

## Psychometric database
### Preparing psycho dataframe
This demographic and psychometric data were collected by the MONRADO team. 
The data file was cleaned following this flowchart (fig.3).

![](https://raw.githubusercontent.com/Ouphix/synchro-psychotherapies/master/Monrado/Data/images/report/FlowchartMonrado-small.jpeg)

```{r import psychometric database, results='hide'}
psycho <- read.csv2("/Users/Ofix/Documents/Fac/internat/Recherche/projets/synchro/synchroData/Monrado/Data/CSV/PsychomotData.csv")

# replace 1 code by male and 2 by female
psycho$Sex[which(psycho$Sex == 1 )] <- "male"
psycho$Sex[which(psycho$Sex == 2 )] <- "female"

psycho$Birth_place <- as.character(psycho$Birth_place)
# Clean Besancon town name with a special character
psycho$Birth_place[which(psycho$Birth_place =="Besan\x8don")] <- "Besancon" 

psycho$Num_identification <- NULL
psycho$Sex <- NULL
psycho$TASDF <- NULL
psycho$TASIF <- NULL
psycho$TASEOT<- NULL
psycho <- rename (psycho, c("Num._ident_videos" = "family"))
#View(psycho)
#str(psycho)
```

### Data dictionnary of cutFrames dataframe
* **family** : code of the family
* **interview_date** : interview_date in a character format
* **Birthday** : Birthday of the child
* **Birth_place** : Birth place of the child
* **attachement_style** : attachement style in 7 factors
* **attachement_cluster** : attachement style in 5 factors, DUALS will be excluded
* **Insecurity_level** : level of insecurity not used
* **global score** : global score of attachment not used
* **TAS1** : score for 1st question of TAS Questionnaire : Toronto Alexithymia Score idem until TAS20 (Alexithymia questionnaire : difficulty to express emotions)
* **TAS_total** : total score of TAS
* **STAIYA1** : score for the 1st question of State-Trait Anxiety Inventory State score (at this specific moment), for the 1st question of State-Trait Anxiety Inventory State idem until 20
* **STAIYA_total** : total score of STAIYA Anxiety State score (at this specific moment)
* **STAIYB1** : score for the 1st question of State-Trait Anxiety Inventory Trait score (not at this specific moment), idem until 20
* **STAIYB_total** : total score of STAIYB Anxiety Trait score (not at this specific moment)
* **BDI1** : score for the 1st question of the BDI (Beck Depression Inventory questionnaire) (Depression questionnaire) idem until BDI13
* **BDI_total** : total score of BDI (Beck Depression Inventory questionnaire)

## Merge the data, the annotation (cutFrames) and psycho  data frames
```{r to translate for ME}
# merge the two data frames
data <- merge(data, cutFrames, by.x="family", by.y="family")
data <- merge(data, psycho, by.x="family", by.y="family")

# reorder by family, then by frame order
data <- data[order(data$family, data$frame),]

# Create a column corresponding to the phase of the video for each time limit
data$LabelVideo <- rep(NA, nrow(data)) 
data[which(data$timeMin <= data$CutBeforeMin),]$LabelVideo <- "Cut"

data[which(data$timeMin > data$CutBeforeMin & data$timeMin < data$CutMiddle1Min),]$LabelVideo <- "No Conflict"

data[which(data$timeMin >= data$CutMiddle1Min & data$timeMin <= data$CutMiddle2Min),]$LabelVideo <- "Cut"

data[which(data$timeMin > data$CutMiddle2Min & data$timeMin < data$CutFinalMin),]$LabelVideo <- "Conflict"

data[which(data$timeMin >= data$CutFinalMin),]$LabelVideo <- "Cut"

#View(data)
```

* **LabelVideo** : description of the phase of the video : cut, No-Conflict, Cut, or Conflict

# Presentation of the data
```{r Presentation of the data, cache=FALSE}
str(data)
summary(data)
```

# Demographic and Psychometric data
## Demographic description
### Sex
```{r Demographic description, eval=TRUE}
par(mar=c(3,4,4,4))
barplot(table(cutFrames$ChildSex), col=c("red", "blue"), main ="Sex repartition, boxplot")
prop.table(table(cutFrames$ChildSex))
```

### Age
```{r age, fig.height=4}
psycho$Birthday <- as.Date(psycho$Birthday, format="%d/%m/%y")
psycho$interview_date <- as.Date(psycho$interview_date, format="%d/%m/%y")
str(psycho$Birthday )
str(psycho$interview_date)
psycho$age <- (psycho$interview_date-psycho$Birthday)/365.25
psycho$age <- as.numeric(psycho$age)

par(mar=c(3,4,4,4))
hist(psycho$age, col="green", main="Histogram of the age of the teenagers")
str(psycho$age)
sd(psycho$age)
```

### Birth places
```{r Birth places, fig.height=4}
par(mar=c(5,4,4,4))
barplot(sort(table(psycho$Birth_place), decreasing = TRUE ), las=2, cex.names=0.5, main="Barplot of the Birth places", col="yellow")
```

## Attachement styles
### Raw
```{r Attachement styles raw, fig.height=4}
par(mar=c(9,5,3,3))
barplot(table(psycho$attachement_style), las=2, cex.names=0.6, col="blue")
```

### Clusters
```{r Attachement styles clusters, fig.height=4}
par(mar=c(4,3,3,3))
barplot(table(psycho$attachement_cluster), las=2, cex.names=0.6, col="cornflowerblue", main="Bar plot of attachement style after clustering")
prop.table(table(psycho$attachement_cluster))
```

## TAS
```{r TAS, fig.height=4}
par(mar=c(3,3,3,3))
barplot(table(psycho$TAS_total), las=2, col="orange", main="Distribution of the TAS scores", cex.name=0.9)

hist(psycho$TAS_total, las=1, col="orange", main="Histogram of the TAS scores")
```

## STAIYA
```{r STAIYA, fig.height=4}
par(mar=c(3,3,3,3))
barplot(table(psycho$STAIYA_total), las=2, col="blue", main="Barplot of the STAIYA scores")

hist(psycho$STAIYA_total, las=1, col="blue", main="Histogram of the STAIY-A scores")
```

## STAIYB
```{r STAIYB, fig.height=4}
par(mar=c(3,3,3,3))
barplot(table(psycho$STAIYB_total), las=2, col="red", main="Barplot of the STAIYB scores")

hist(psycho$STAIYB_total, las=1, col="red", main="Histogram of the STAIY-B scores")
```

## BDI total
```{r BDI total, fig.height=4}
par(mar=c(3,3,3,3))
barplot(table(psycho$BDI_total), las=2, col="green", main="Barplot of the BDI scores")

hist(psycho$BDI_total, las=1, col="green", main="Histogram of the BDI scores")
```
