---
title: "Shuffle"
author: "Thomas Gargot"
date: "30/9/2016"
output: html_document
---

This script suffles the motion history data that we have before the computing of the synchrony. 
If the signal is the same, we won't be able to say that we have a synchony scores that are explained by the interaction.

# Clean environment
```{r Clean Environment}
rm(list = ls(all.names = TRUE))
```

# Session info
```{r}
sessionInfo()
```

# Preparation of the session
```{r import libraries, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
# To use this script, you must install packages (install.packages()) to install these packages if you don't have them.

# Loading libraries
## For managing data frames easilly : rbinds function
library("plyr")
## For editing string
library("stringr")
## For computing AUC of syncrony plots
library("pracma")
```

#Import data
```{r}
setwd("./Git/Monrado/Reports/")
filesList <- list.files("../Data/CSV/filtered/noLog/noshuffled", full.names=FALSE)
filesList
fileShort <- c()
for (file in filesList){
  fileShort <- c(fileShort, strsplit(file,".slideddata.csv")[[1]])
}
fileShort

MHfilteredFilesList <- list.files("../Data/CSV/filtered/noLog/noshuffled", full.name=TRUE)
MHfilteredFilesList
```

# Shuffle the data and add a column parent with the motion history of either the mother or the father
```{r}
# MHfiltered <- data.frame(video="a")
    a <- 1
for (file in MHfilteredFilesList){
    MHfilteredalone <- read.csv(file)
#    str(MHfileredalone)
    MHfilteredalone$X <- NULL
    str(MHfilteredalone)
    MHfilteredalone$slidedParent <- rowSums(MHfilteredalone[,c("slidedFather", "slidedMother")], na.rm=TRUE)
# shuffle the motion history of the patient (slidedChild) and create a new column. Repeat the process 100 times
    for (i in 7:107){
    MHfilteredalone[,i] <-sample(MHfilteredalone$slidedChild)
    }
   str(MHfilteredalone[,1:6])
   write.csv(MHfilteredalone, paste("../Data/CSV/filtered/noLog/shuffled/", fileShort[a], ".shuffled.slideddata.csv", sep=""))
#    MHfiltered <- rbind.fill(MHfiltered, MHfilteredalone)
#    str(MHfilered[,1:6])
   a <- a+1
    }
#MHfiltered <- MHfiltered[-1,]

View(MHfiltered)
```

```{r}
videoIndex <- 1
# videoName is the name of current video
for (videoName in unique(MHfilered$video)){
# Compute slinding interval for each participant
      
      slidedVideo <- data.frame(
        slidedFather, slidedMother, slidedChild, 
        "video"=rep(families[videoIndex], length(slidedFather)), 
        frame_index = 1:length(slidedFather))
# write the file       
            write.csv(slidedVideo, paste("../Data/CSV/filtered/noLog/",videoName, ".slideddata.csv", sep=""))
      videoIndex <-(videoIndex+1)
      }
```

